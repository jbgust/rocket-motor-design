<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>


    <style lang="css">
       body {
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }
        input {
            width: 130px;
        }
        select {
            width: 130px;
        }
        label {
            display: inline-block;
            width: 240px;
            padding-left: 20px;
        }
        .compute-btn {
            margin-left: 129px;
            margin-top: 10px;
        }
        .resultat {

        }
        .label-resultat {
            display: inline-block;
            width: 180px;
            padding-left: 20px;
            margin: 0 10px;
            text-align: right;
        }

    </style>

</head>
<body>

<div style="flex-direction:row; display:flex; margin: 10px; width: 100%;">
    <div style="margin-right: 40px; width:420px;">

        <div style="padding:10px; margin-top: 20px; border: 1px solid black;">
            <h3 style="margin-bottom:5px;margin-top:0px;">Motor parameters</h3>
            <form th:action="@{/test}" method="post" th:object="${request}">
                <div class="form-element"><label>Throat diameter [mm]: </label><input th:field="*{throatDiameter}"/></div>
                <div class="form-element"><label>Grain outer diameter [mm]: </label><input th:field="*{outerDiameter}"/></div>
                <div class="form-element"><label>Grain core diameter [mm]: </label><input th:field="*{coreDiameter}"/></div>
                <div class="form-element"><label>Grain segment length [mm]: </label><input th:field="*{segmentLength}"/></div>
                <div class="form-element"><label>Number of segment: </label><input th:field="*{numberOfSegment}"/></div>

                <div class="form-element"><label>Outer surface: </label><select th:field="*{outerSurface}" name="outerSurface">
                    <option th:each="i : ${surfaces}" th:value="${i.name}" th:text="${i.name}">
                    </option>
                </select></div>
                <div class="form-element"><label>Ends surface: </label><select th:field="*{endsSurface}">
                    <option th:each="i : ${surfaces}" th:value="${i.name}" th:text="${i.name}">
                    </option>
                </select></div>

                    <div class="form-element"><label>Core surface: </label><select th:field="*{coreSurface}">
                        <option th:each="i : ${surfaces}" th:value="${i.name}" th:text="${i.name}">
                        </option>
                    </select></div>

                        <div class="form-element"><label>Propellant: </label><select th:field="*{propellantType}">
                            <option th:each="i : ${propellants}" th:value="${i.name}" th:text="${i.name}">
                            </option>
                        </select></div>

                <div class="form-element"><label>Chamber inner diameter [mm]:</label><input th:field="*{chamberInnerDiameter}"/></div>
                <div class="form-element"><label>Chamber length [mm]: </label><input th:field="*{chamberLength}"/></div>
                <input type="submit" class="compute-btn">
            </form>
        </div>

        <div style="padding:10px; margin-top: 20px; border: 1px solid black;" th:if="${error==null}">
            <h3 style="margin-bottom:5px;margin-top:0px;">Performance</h3>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Class : </span><span th:text="${performance.motorDescription}"></span></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Thrust time : </span><span th:text="${performance.thrustTime}"></span></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Max thrust : </span><span th:text="${performance.maxThrust}"></span></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Total impulse : </span><span th:text="${performance.totalImpulse}"></span></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Specific impulse : </span><span th:text="${performance.specificImpulse}"></span></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Max pressure : </span><span th:text="${performance.maxPressure}"></span></div>

            <h3 style="margin-bottom:5px;">Nozzle</h3>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;color: orange;" th:if="${performance.optimalDesign}">Optimal design</span><br th:if="${performance.optimalDesign}"></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Nozzle exit diam. : </span><span th:text="${performance.nozzleExitDiameter}"></span><br></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Divergence length : </span><span th:text="${performance.divergenceLenght}"></span><br></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Convergence length : </span><span th:text="${performance.convergenceLenght}"></span><br></div>
            <div class="resultat"><span class="label-resultat" style="font-weight: bold;">Initial exit speed : </span><span th:text="${performance.exitSpeedInitial}"></span><br></div>
        </div>
    </div>
    <div id="chartdiv" style="height:750px;width: calc(90% - 420px);">
        <p th:if="${error!=null}" style="color:red; font-size:24px;">Simulation failed</p>
        <textarea th:if="${error!=null}" th:text="${error}" readonly cols="130" rows="50"></textarea>
    </div>
</div>


</body>
</html>


<script th:if="${error==null}" th:inline="javascript">
        /**
 * ---------------------------------------
 * This demo was created using amCharts 4.
 *
 * For more information visit:
 * https://www.amcharts.com/
 *
 * Documentation is available at:
 * https://www.amcharts.com/docs/v4/
 * ---------------------------------------
 */

// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

// Create chart instance
var chart = am4core.create("chartdiv", am4charts.XYChart);
chart.paddingRight = 20;

// Add data
chart.data = [[${results}]];
chart.numberFormatter.numberFormat = ".##";

// Create axes
var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
categoryAxis.dataFields.category = "timeSinceBurnStartInSecond";
categoryAxis.renderer.minGridDistance = 50;
categoryAxis.renderer.grid.template.location = 0.5;
categoryAxis.startLocation = -5;
categoryAxis.endLocation = 10;
categoryAxis.title.text = "Thrust time (sec.)";

// Create value axis
var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
valueAxis.baseValue = 0;
valueAxis.title.text = "Thrust (N)";


// Create series
var series = chart.series.push(new am4charts.LineSeries());
series.dataFields.valueY = "thrustInNewton";
series.dataFields.categoryX = "timeSinceBurnStartInSecond";
series.tooltipText = "{valueY.value.formatNumber('#.')} N :  {categoryX.formatNumber('.##')} s";
series.strokeWidth = 2;
series.tensionX = 12;

chart.cursor = new am4charts.XYCursor();
/*
categoryAxis.adapter.add("getTooltipText", (text) => {
 return ".###";
});
*/

</script>
